<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>xRenderforINDS: indsInterface.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>indsInterface.py</h1><a href="inds_interface_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">#!/usr/bin/env python</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="keyword">import</span> sys
<a name="l00004"></a>00004 <span class="keyword">import</span> os
<a name="l00005"></a>00005 <span class="keyword">import</span> tempfile
<a name="l00006"></a>00006 <span class="keyword">import</span> httplib
<a name="l00007"></a>00007 <span class="keyword">import</span> logging
<a name="l00008"></a>00008 <span class="keyword">import</span> ConfigParser
<a name="l00009"></a>00009 <span class="keyword">import</span> md5
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="comment"># My code!</span>
<a name="l00012"></a>00012 <span class="keyword">import</span> osSpec
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="comment">## Routines for the INDS HTTP interface - URL creation, etc. This code</span>
<a name="l00015"></a>00015 <span class="comment"># creates a set of dictionaries keyed on cmdId for dictToDot to parse and transform</span>
<a name="l00016"></a>00016 <span class="comment"># into graphviz dot. I tried to make it efficient - the config file is loaded once, each</span>
<a name="l00017"></a>00017 <span class="comment"># URL is only fetched once, transient commands are ignored, and config files aren't loaded</span>
<a name="l00018"></a>00018 <span class="comment">#  unless (not used at present) the parent asks for them.</span>
<a name="l00019"></a>00019 <span class="comment">#</span>
<a name="l00020"></a>00020 <span class="comment"># @file indsInterface.py</span>
<a name="l00021"></a>00021 <span class="comment"># @note This version is reworked to use httplib instead of urllib2. Persistent connection == speed.</span>
<a name="l00022"></a>00022 <span class="comment"># @author Paul Hubbard pfhubbar@ucsd.edu</span>
<a name="l00023"></a>00023 <span class="comment"># @date 1/21/09</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment">##  Class to pull data from the INDS webservice and reformat it</span>
<a name="l00027"></a><a class="code" href="classinds_interface_1_1inds_interface.html">00027</a> <span class="keyword">class </span><a class="code" href="classinds_interface_1_1inds_interface.html" title="Class to pull data from the INDS webservice and reformat it.">indsInterface</a>:
<a name="l00028"></a>00028     <span class="comment">## Constructor creates objects and opens the connection</span>
<a name="l00029"></a><a class="code" href="classinds_interface_1_1inds_interface.html#c778adf5252f6b8393c6ca0b6cd30da4">00029</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#c778adf5252f6b8393c6ca0b6cd30da4" title="Constructor creates objects and opens the connection.">__init__</a>(self):
<a name="l00030"></a>00030         cmdIds = []
<a name="l00031"></a>00031         niceName = dict()
<a name="l00032"></a>00032         xml = dict()
<a name="l00033"></a>00033         cmdType = dict()
<a name="l00034"></a>00034         
<a name="l00035"></a>00035         <span class="comment"># Defaults, overriden by loadConfig</span>
<a name="l00036"></a>00036         hostname = <span class="stringliteral">'localhost'</span> 
<a name="l00037"></a>00037         viewerHostname = <span class="stringliteral">'localhost'</span>
<a name="l00038"></a>00038         
<a name="l00039"></a>00039         self.<a class="code" href="classinds_interface_1_1inds_interface.html#de74c7c1cf79ebbfeec735f8c231cb41" title="Look up INDS hostname from config file &amp;#39;defaults.cfg&amp;#39; Also look up hostname...">loadConfig</a>()
<a name="l00040"></a>00040         
<a name="l00041"></a>00041         <span class="keywordflow">try</span>:
<a name="l00042"></a>00042             self.<a class="code" href="classinds_interface_1_1inds_interface.html#2fb3c9f716e6f6f83b198747157d7e85">conn</a> = httplib.HTTPConnection(self.<a class="code" href="classinds_interface_1_1inds_interface.html#ec84cf98233a27846f99f0e45772f975">hostname</a>)
<a name="l00043"></a>00043         <span class="keywordflow">except</span> httplib.HTTPException, e:
<a name="l00044"></a>00044             self.<a class="code" href="classinds_interface_1_1inds_interface.html#3542d5d90645783b800d0cdf7719cad0">connected</a> = <span class="keyword">False</span>;
<a name="l00045"></a>00045             logging.exception(e)
<a name="l00046"></a>00046         <span class="keywordflow">else</span>:
<a name="l00047"></a>00047             self.<a class="code" href="classinds_interface_1_1inds_interface.html#3542d5d90645783b800d0cdf7719cad0">connected</a> = <span class="keyword">True</span>   
<a name="l00048"></a>00048     
<a name="l00049"></a>00049     <span class="comment">## Close http 1.1 (persistent) connection, if open  </span>
<a name="l00050"></a><a class="code" href="classinds_interface_1_1inds_interface.html#b48459ae3bc49425b71b93754ac9d54f">00050</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#b48459ae3bc49425b71b93754ac9d54f" title="Close http 1.1 (persistent) connection, if open.">close</a>(self):
<a name="l00051"></a>00051         <span class="keywordflow">if</span> self.<a class="code" href="classinds_interface_1_1inds_interface.html#3542d5d90645783b800d0cdf7719cad0">connected</a> == <span class="keyword">True</span>:
<a name="l00052"></a>00052             self.<a class="code" href="classinds_interface_1_1inds_interface.html#2fb3c9f716e6f6f83b198747157d7e85">conn</a>.close()
<a name="l00053"></a>00053             self.<a class="code" href="classinds_interface_1_1inds_interface.html#3542d5d90645783b800d0cdf7719cad0">connected</a> = <span class="keyword">False</span>
<a name="l00054"></a>00054                 
<a name="l00055"></a>00055     <span class="comment">## Variables</span>
<a name="l00056"></a><a class="code" href="classinds_interface_1_1inds_interface.html#b1707a8db8a7da6e271f5bf306a039cd">00056</a>     cmdIds = []
<a name="l00057"></a>00057     niceName = dict()
<a name="l00058"></a>00058     xml = dict()
<a name="l00059"></a>00059     cmdType = dict()
<a name="l00060"></a>00060     hostname = <span class="stringliteral">'localhost'</span> 
<a name="l00061"></a>00061     viewerHostname = <span class="stringliteral">'localhost'</span>
<a name="l00062"></a>00062     connected = <span class="keyword">False</span>
<a name="l00063"></a>00063     hexDigest = <span class="stringliteral">''</span>
<a name="l00064"></a>00064     
<a name="l00065"></a>00065     <span class="comment">## Look up INDS hostname from config file 'defaults.cfg'</span>
<a name="l00066"></a>00066     <span class="comment"># Also look up hostname of INDS viewer, which may be separate</span>
<a name="l00067"></a><a class="code" href="classinds_interface_1_1inds_interface.html#de74c7c1cf79ebbfeec735f8c231cb41">00067</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#de74c7c1cf79ebbfeec735f8c231cb41" title="Look up INDS hostname from config file &amp;#39;defaults.cfg&amp;#39; Also look up hostname...">loadConfig</a>(self):
<a name="l00068"></a>00068         myOS = osSpec.osSpec()
<a name="l00069"></a>00069 
<a name="l00070"></a>00070         self.<a class="code" href="classinds_interface_1_1inds_interface.html#ec84cf98233a27846f99f0e45772f975">hostname</a> = myOS.indsHostname
<a name="l00071"></a>00071         self.<a class="code" href="classinds_interface_1_1inds_interface.html#cedf22082c63370d14121e3954c00763">viewerHostname</a> = myOS.viewHostname
<a name="l00072"></a>00072         self.<a class="code" href="classinds_interface_1_1inds_interface.html#fb2e599263a1fd1df44833095f3427c5">hexDigest</a> = myOS.hexDigest
<a name="l00073"></a>00073     
<a name="l00074"></a>00074     <span class="comment">## Routine to create a URL from an INDS command.</span>
<a name="l00075"></a><a class="code" href="classinds_interface_1_1inds_interface.html#6e54f9dadab9b75927eb188b7d77a6a6">00075</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#6e54f9dadab9b75927eb188b7d77a6a6" title="Routine to create a URL from an INDS command.">makeUrl</a>(self, cmdString):
<a name="l00076"></a>00076         <span class="keywordflow">return</span> <span class="stringliteral">'/indsExec/%s'</span> % cmdString
<a name="l00077"></a>00077 
<a name="l00078"></a>00078     <span class="comment">## Subroutine to fetch text via HTTP from a URL</span>
<a name="l00079"></a><a class="code" href="classinds_interface_1_1inds_interface.html#515c14b70fa1a1d4c0ebc0686a640811">00079</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#515c14b70fa1a1d4c0ebc0686a640811" title="Subroutine to fetch text via HTTP from a URL.">getFromUrl</a>(self, cmdUrl):
<a name="l00080"></a>00080         <span class="keywordflow">if</span> self.<a class="code" href="classinds_interface_1_1inds_interface.html#3542d5d90645783b800d0cdf7719cad0">connected</a> == <span class="keyword">False</span>:
<a name="l00081"></a>00081             logging.error(<span class="stringliteral">'Cannot fetch "%s", disconnected'</span> % cmdUrl)
<a name="l00082"></a>00082             <span class="keywordflow">return</span> <span class="stringliteral">''</span>
<a name="l00083"></a>00083         
<a name="l00084"></a>00084         <span class="keywordflow">try</span>:
<a name="l00085"></a>00085             self.<a class="code" href="classinds_interface_1_1inds_interface.html#2fb3c9f716e6f6f83b198747157d7e85">conn</a>.request(<span class="stringliteral">"GET"</span>, cmdUrl)    
<a name="l00086"></a>00086             r1 = self.<a class="code" href="classinds_interface_1_1inds_interface.html#2fb3c9f716e6f6f83b198747157d7e85">conn</a>.getresponse()
<a name="l00087"></a>00087 
<a name="l00088"></a>00088             <span class="comment"># Request OK?</span>
<a name="l00089"></a>00089             <span class="keywordflow">if</span> r1.status == 200:
<a name="l00090"></a>00090                 hText = r1.read()
<a name="l00091"></a>00091                 <span class="keywordflow">return</span> hText
<a name="l00092"></a>00092             <span class="keywordflow">else</span>:
<a name="l00093"></a>00093                 logging.error(<span class="stringliteral">'HTTP error %d (%s) on "%s"'</span> % \
<a name="l00094"></a>00094                 (r1.status, r1.reason, cmdUrl))
<a name="l00095"></a>00095         <span class="keywordflow">except</span> httplib.HTTPException, e:
<a name="l00096"></a>00096             logging.exception(e)
<a name="l00097"></a>00097             <span class="keywordflow">raise</span> 
<a name="l00098"></a>00098     
<a name="l00099"></a>00099     <span class="comment">## Get config XML snippet for a given command ID</span>
<a name="l00100"></a><a class="code" href="classinds_interface_1_1inds_interface.html#08bd0356a34a462151a8b27fa36e8d7f">00100</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#08bd0356a34a462151a8b27fa36e8d7f" title="Get config XML snippet for a given command ID.">getCmdXML</a>(self, cmdName):
<a name="l00101"></a>00101         cmdUrl = self.<a class="code" href="classinds_interface_1_1inds_interface.html#6e54f9dadab9b75927eb188b7d77a6a6" title="Routine to create a URL from an INDS command.">makeUrl</a>(<span class="stringliteral">'?action=getConfiguration&amp;cmd=%s'</span> % cmdName)
<a name="l00102"></a>00102         <span class="keywordflow">return</span> self.<a class="code" href="classinds_interface_1_1inds_interface.html#515c14b70fa1a1d4c0ebc0686a640811" title="Subroutine to fetch text via HTTP from a URL.">getFromUrl</a>(cmdUrl)
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <span class="comment">## For a given command, return the URL to associate with the graph node. </span>
<a name="l00105"></a>00105     <span class="comment"># Used to be getConfigUrl, now via indsViewer</span>
<a name="l00106"></a><a class="code" href="classinds_interface_1_1inds_interface.html#62d46ca5f4b0ab2bf71025887e2ccc93">00106</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#62d46ca5f4b0ab2bf71025887e2ccc93" title="For a given command, return the URL to associate with the graph node.">getInfoUrl</a>(self, cmdId):
<a name="l00107"></a>00107         infoUrl = <span class="stringliteral">'http://%s/indsViewer/index.jsp?command=%s'</span> % \
<a name="l00108"></a>00108         (self.<a class="code" href="classinds_interface_1_1inds_interface.html#cedf22082c63370d14121e3954c00763">viewerHostname</a>, cmdId)
<a name="l00109"></a>00109         <span class="keywordflow">return</span> infoUrl
<a name="l00110"></a>00110         
<a name="l00111"></a>00111     <span class="comment">## Get 'nice' name for a command ID</span>
<a name="l00112"></a><a class="code" href="classinds_interface_1_1inds_interface.html#38b1f1939e87bc6fe87770c840396b76">00112</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#38b1f1939e87bc6fe87770c840396b76" title="Get &amp;#39;nice&amp;#39; name for a command ID.">getNiceName</a>(self, cmdId):
<a name="l00113"></a>00113         cmdUrl = self.<a class="code" href="classinds_interface_1_1inds_interface.html#6e54f9dadab9b75927eb188b7d77a6a6" title="Routine to create a URL from an INDS command.">makeUrl</a>(<span class="stringliteral">'?action=getName&amp;cmd=%s'</span> % cmdId)
<a name="l00114"></a>00114         <span class="keywordflow">return</span> self.<a class="code" href="classinds_interface_1_1inds_interface.html#515c14b70fa1a1d4c0ebc0686a640811" title="Subroutine to fetch text via HTTP from a URL.">getFromUrl</a>(cmdUrl)
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="comment">## Get command type for a command ID. Types are source, server, sink, transient or DP</span>
<a name="l00117"></a>00117     <span class="comment"># DP are plugin and converter</span>
<a name="l00118"></a><a class="code" href="classinds_interface_1_1inds_interface.html#0053208d21cb2dffbe3fd485fdecdbdb">00118</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#0053208d21cb2dffbe3fd485fdecdbdb" title="Get command type for a command ID.">getCmdType</a>(self, cmdId):
<a name="l00119"></a>00119         cmdUrl = self.<a class="code" href="classinds_interface_1_1inds_interface.html#6e54f9dadab9b75927eb188b7d77a6a6" title="Routine to create a URL from an INDS command.">makeUrl</a>(<span class="stringliteral">'?action=getCommandClassification&amp;cmd=%s'</span> % cmdId)
<a name="l00120"></a>00120         <span class="keywordflow">return</span> self.<a class="code" href="classinds_interface_1_1inds_interface.html#515c14b70fa1a1d4c0ebc0686a640811" title="Subroutine to fetch text via HTTP from a URL.">getFromUrl</a>(cmdUrl)
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     <span class="comment">## Return the URL of the configuration file. Not presently used.</span>
<a name="l00123"></a><a class="code" href="classinds_interface_1_1inds_interface.html#8a793c01212970ce6e08823153a00083">00123</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#8a793c01212970ce6e08823153a00083" title="Return the URL of the configuration file.">getConfigUrl</a>(self, cmdId):
<a name="l00124"></a>00124         <span class="keywordflow">return</span> self.<a class="code" href="classinds_interface_1_1inds_interface.html#6e54f9dadab9b75927eb188b7d77a6a6" title="Routine to create a URL from an INDS command.">makeUrl</a>(<span class="stringliteral">'?action=getChildConfiguration&amp;cmd=%s'</span> % cmdId)
<a name="l00125"></a>00125     
<a name="l00126"></a>00126     <span class="comment">## Get config file for a command ID. Not presently used.</span>
<a name="l00127"></a><a class="code" href="classinds_interface_1_1inds_interface.html#978cb22bda8a9d45c87fa12f294df260">00127</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#978cb22bda8a9d45c87fa12f294df260" title="Get config file for a command ID.">getConfigFile</a>(self, cmdId):
<a name="l00128"></a>00128         <span class="keywordflow">return</span> self.<a class="code" href="classinds_interface_1_1inds_interface.html#515c14b70fa1a1d4c0ebc0686a640811" title="Subroutine to fetch text via HTTP from a URL.">getFromUrl</a>(self.<a class="code" href="classinds_interface_1_1inds_interface.html#8a793c01212970ce6e08823153a00083" title="Return the URL of the configuration file.">getConfigUrl</a>(cmdId))
<a name="l00129"></a>00129     
<a name="l00130"></a>00130     <span class="comment">## Get the complete XML config document     </span>
<a name="l00131"></a><a class="code" href="classinds_interface_1_1inds_interface.html#e3a363ae340c0391942cb20857d0a3c6">00131</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#e3a363ae340c0391942cb20857d0a3c6" title="Get the complete XML config document.">getCompleteXml</a>(self):
<a name="l00132"></a>00132         <span class="keywordflow">return</span> self.<a class="code" href="classinds_interface_1_1inds_interface.html#515c14b70fa1a1d4c0ebc0686a640811" title="Subroutine to fetch text via HTTP from a URL.">getFromUrl</a>(self.<a class="code" href="classinds_interface_1_1inds_interface.html#6e54f9dadab9b75927eb188b7d77a6a6" title="Routine to create a URL from an INDS command.">makeUrl</a>(<span class="stringliteral">'?action=getRootConfiguration'</span>))
<a name="l00133"></a>00133     
<a name="l00134"></a>00134     <span class="comment">## Speed optimization - checks to see if the XML configuration has changed since the last run.</span>
<a name="l00135"></a>00135     <span class="comment"># Uses an MD5 hash of the XML document, saved as the hex digest in the configuration file.</span>
<a name="l00136"></a>00136     <span class="comment"># @note that this will also save the new digest when called!            </span>
<a name="l00137"></a><a class="code" href="classinds_interface_1_1inds_interface.html#6a3032062d083ec51a8d5fd4ac5585c8">00137</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#6a3032062d083ec51a8d5fd4ac5585c8" title="Speed optimization - checks to see if the XML configuration has changed since the...">isStale</a>(self):
<a name="l00138"></a>00138         <span class="comment"># Compute the MD5 hash of the XML document</span>
<a name="l00139"></a>00139         md = md5.new()
<a name="l00140"></a>00140         pText = self.<a class="code" href="classinds_interface_1_1inds_interface.html#e3a363ae340c0391942cb20857d0a3c6" title="Get the complete XML config document.">getCompleteXml</a>()
<a name="l00141"></a>00141         md.update(pText)
<a name="l00142"></a>00142         
<a name="l00143"></a>00143         <span class="comment"># Compare it to the last-run hash saved in the config file</span>
<a name="l00144"></a>00144         <span class="keywordflow">if</span> md.hexdigest() == self.<a class="code" href="classinds_interface_1_1inds_interface.html#fb2e599263a1fd1df44833095f3427c5">hexDigest</a>:
<a name="l00145"></a>00145             logging.debug(<span class="stringliteral">'Hex digest matches last run from config file'</span>)
<a name="l00146"></a>00146             <span class="keywordflow">return</span> <span class="keyword">True</span>
<a name="l00147"></a>00147         <span class="keywordflow">else</span>:
<a name="l00148"></a>00148             logging.debug(<span class="stringliteral">'New hex digest: %s Old: %s'</span> % (md.hexdigest(), self.<a class="code" href="classinds_interface_1_1inds_interface.html#fb2e599263a1fd1df44833095f3427c5">hexDigest</a>))
<a name="l00149"></a>00149             mc = osSpec.osSpec()
<a name="l00150"></a>00150             mc.updateHexDigest(md.hexdigest())
<a name="l00151"></a>00151             <span class="keywordflow">return</span> <span class="keyword">False</span>
<a name="l00152"></a>00152                 
<a name="l00153"></a>00153     <span class="comment">## Build array of command IDs</span>
<a name="l00154"></a><a class="code" href="classinds_interface_1_1inds_interface.html#917943423d2bd06561639dc283209199">00154</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#917943423d2bd06561639dc283209199" title="Build array of command IDs.">getCmdList</a>(self):
<a name="l00155"></a>00155         plUrl = self.<a class="code" href="classinds_interface_1_1inds_interface.html#6e54f9dadab9b75927eb188b7d77a6a6" title="Routine to create a URL from an INDS command.">makeUrl</a>(<span class="stringliteral">''</span>)
<a name="l00156"></a>00156         logging.info(<span class="stringliteral">'Trying to get process list from "%s" ...'</span> % plUrl)
<a name="l00157"></a>00157 
<a name="l00158"></a>00158         pText = self.<a class="code" href="classinds_interface_1_1inds_interface.html#515c14b70fa1a1d4c0ebc0686a640811" title="Subroutine to fetch text via HTTP from a URL.">getFromUrl</a>(plUrl)
<a name="l00159"></a>00159         
<a name="l00160"></a>00160             
<a name="l00161"></a>00161         <span class="comment"># Convert into native array</span>
<a name="l00162"></a>00162         pList = pText.split()
<a name="l00163"></a>00163         <span class="keywordflow">return</span> pList
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="comment">## Build a list entry for the dictionary    </span>
<a name="l00166"></a><a class="code" href="classinds_interface_1_1inds_interface.html#2c4ce6abe86b2a7f94f863d21ae00d0e">00166</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#2c4ce6abe86b2a7f94f863d21ae00d0e" title="Build a list entry for the dictionary.">buildEntry</a>(self, cmdId):
<a name="l00167"></a>00167 
<a name="l00168"></a>00168         <span class="comment"># Skip stuff like sleep, del</span>
<a name="l00169"></a>00169         tmp = self.<a class="code" href="classinds_interface_1_1inds_interface.html#0053208d21cb2dffbe3fd485fdecdbdb" title="Get command type for a command ID.">getCmdType</a>(cmdId)
<a name="l00170"></a>00170         <span class="keywordflow">if</span> tmp == <span class="stringliteral">'transient'</span>:
<a name="l00171"></a>00171             <span class="keywordflow">return</span>
<a name="l00172"></a>00172             
<a name="l00173"></a>00173         <span class="comment"># Add new cmdId to array</span>
<a name="l00174"></a>00174         self.<a class="code" href="classinds_interface_1_1inds_interface.html#b1707a8db8a7da6e271f5bf306a039cd" title="Variables.">cmdIds</a>.append(cmdId)
<a name="l00175"></a>00175         
<a name="l00176"></a>00176         <span class="comment"># Fetch snippets from INDS and insert into dictionaries</span>
<a name="l00177"></a>00177         self.<a class="code" href="classinds_interface_1_1inds_interface.html#3e427c64fcc21abb43785b162aa71728">niceName</a>[cmdId] = self.<a class="code" href="classinds_interface_1_1inds_interface.html#38b1f1939e87bc6fe87770c840396b76" title="Get &amp;#39;nice&amp;#39; name for a command ID.">getNiceName</a>(cmdId)
<a name="l00178"></a>00178         self.<a class="code" href="classinds_interface_1_1inds_interface.html#fcce2e0ab998dd8ed6985ae3e31fefff">xml</a>[cmdId] = self.<a class="code" href="classinds_interface_1_1inds_interface.html#08bd0356a34a462151a8b27fa36e8d7f" title="Get config XML snippet for a given command ID.">getCmdXML</a>(cmdId)
<a name="l00179"></a>00179         self.<a class="code" href="classinds_interface_1_1inds_interface.html#808117f7c070c0d46162b7eb30cb22c1">cmdType</a>[cmdId] = self.<a class="code" href="classinds_interface_1_1inds_interface.html#0053208d21cb2dffbe3fd485fdecdbdb" title="Get command type for a command ID.">getCmdType</a>(cmdId)
<a name="l00180"></a>00180         
<a name="l00181"></a>00181     <span class="comment">## Main code entry point</span>
<a name="l00182"></a><a class="code" href="classinds_interface_1_1inds_interface.html#373d3bc23aeb4ec58c9658c9d45d9a2d">00182</a>     <span class="keyword">def </span><a class="code" href="classinds_interface_1_1inds_interface.html#373d3bc23aeb4ec58c9658c9d45d9a2d" title="Main code entry point.">main</a>(self): 
<a name="l00183"></a>00183         pList = self.<a class="code" href="classinds_interface_1_1inds_interface.html#917943423d2bd06561639dc283209199" title="Build array of command IDs.">getCmdList</a>()
<a name="l00184"></a>00184         <span class="keywordflow">if</span> pList == []:
<a name="l00185"></a>00185             logging.error(<span class="stringliteral">'An error occurred fetching the list of commands!'</span>)
<a name="l00186"></a>00186             <span class="keywordflow">return</span>      
<a name="l00187"></a>00187 
<a name="l00188"></a>00188         logging.debug(<span class="stringliteral">'Building dictionaries'</span>)
<a name="l00189"></a>00189         <span class="keywordflow">for</span> x <span class="keywordflow">in</span> pList:
<a name="l00190"></a>00190             self.<a class="code" href="classinds_interface_1_1inds_interface.html#2c4ce6abe86b2a7f94f863d21ae00d0e" title="Build a list entry for the dictionary.">buildEntry</a>(x)
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         logging.debug(<span class="stringliteral">'Dictionaries created OK.'</span>)
<a name="l00193"></a>00193         
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="comment">## Test harness </span>
<a name="l00196"></a>00196 <span class="keywordflow">if</span> __name__ == <span class="stringliteral">'__main__'</span>:      
<a name="l00197"></a>00197     logging.basicConfig(level=logging.DEBUG, \
<a name="l00198"></a>00198                         format=<span class="stringliteral">'%(asctime)s %(levelname)s %(message)s'</span>)
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     <span class="keywordflow">try</span>:
<a name="l00201"></a>00201         ii = indsInterface()
<a name="l00202"></a>00202         ii.main()
<a name="l00203"></a>00203         ii.close()
<a name="l00204"></a>00204     <span class="keywordflow">except</span> BaseException, e:
<a name="l00205"></a>00205         logging.exception(e)
<a name="l00206"></a>00206     
<a name="l00207"></a>00207     <span class="keywordflow">for</span> x <span class="keywordflow">in</span> ii.cmdIds:
<a name="l00208"></a>00208         <span class="keywordflow">print</span> x
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Jan 27 13:50:33 2009 for xRenderforINDS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
